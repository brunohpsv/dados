<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dados do Firestore - horariosite</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* [Seus estilos CSS permanecem exatamente os mesmos] */
    </style>
</head>
<body>
    <!-- [Seu HTML permanece exatamente o mesmo] -->

    <script>
        // Configuração do Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyClmS9QnPH_HpLzN8mGW2s2PjfH4HXEAt8",
            projectId: "horariosite-669d1",
        };

        // Inicializa o Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Objeto com as coleções que você quer mostrar
        const collectionsToShow = {
            "usuarios": "Usuários",
            "horarios": "Horários"
        };

        // Objeto para armazenar os dados JSON
        let jsonData = { empresas: [] };
        
        // Variável para manter a URL fixa
        const FIXED_JSON_URL = 'blob:https://brunohpsv.github.io/horariosite-json';

        // Função para criar/manter a URL fixa
        function getFixedJsonUrl() {
            // Tenta recuperar a URL do sessionStorage
            let url = sessionStorage.getItem('fixedJsonUrl');
            
            // Se não existir, cria uma nova
            if (!url) {
                const blob = new Blob(['{}'], {type: 'application/json'});
                url = FIXED_JSON_URL; // Usamos nossa URL fixa
                
                // Monkey patch para simular a URL.createObjectURL com nossa URL fixa
                if (!window.originalCreateObjectURL) {
                    window.originalCreateObjectURL = URL.createObjectURL;
                    URL.createObjectURL = function(blob) {
                        if (blob.type === 'application/json') {
                            return FIXED_JSON_URL;
                        }
                        return window.originalCreateObjectURL(blob);
                    };
                }
                
                sessionStorage.setItem('fixedJsonUrl', url);
            }
            
            return url;
        }

        // Função para atualizar o conteúdo do JSON
        function updateJsonContent(data) {
            const jsonStr = JSON.stringify(data, null, 2);
            
            // Atualiza o Blob associado à URL fixa
            const blob = new Blob([jsonStr], {type: 'application/json'});
            const url = getFixedJsonUrl();
            
            // Atualiza a exibição
            document.getElementById('json-url').value = url;
            document.getElementById('json-viewer').textContent = jsonStr;
        }

        // [Suas outras funções permanecem as mesmas até a loadAllCollections]

        // Modificação na loadAllCollections
        async function loadAllCollections() {
            try {
                const container = document.getElementById('collections-container');
                container.innerHTML = '';
                jsonData.empresas = [];
                
                for (const [collectionName, displayName] of Object.entries(collectionsToShow)) {
                    await loadCollection(collectionName, displayName);
                }
                
                document.getElementById('loading').style.display = 'none';
                updateJsonContent(jsonData); // Atualiza o conteúdo mantendo a URL
                
            } catch (error) {
                console.error("Erro ao carregar coleções:", error);
                document.getElementById('collections-container').innerHTML = `
                    <div class="alert alert-danger">
                        Ocorreu um erro ao carregar os dados: ${error.message}
                    </div>
                `;
                document.getElementById('loading').style.display = 'none';
            }
        }

        // [O restante do seu código permanece igual]

        // Inicialização
        document.addEventListener('DOMContentLoaded', () => {
            // Configura a URL fixa imediatamente
            document.getElementById('json-url').value = getFixedJsonUrl();
            
            loadAllCollections();
            setupPageRefresh();
            
            // Configura os botões
            document.getElementById('view-json-btn').addEventListener('click', () => {
                const viewer = document.getElementById('json-viewer');
                viewer.style.display = viewer.style.display === 'none' ? 'block' : 'none';
            });
            
            document.getElementById('copy-btn').addEventListener('click', () => {
                const jsonUrl = document.getElementById('json-url');
                jsonUrl.select();
                document.execCommand('copy');
                alert('URL copiada para a área de transferência!');
            });
        });
    </script>
</body>
</html>
